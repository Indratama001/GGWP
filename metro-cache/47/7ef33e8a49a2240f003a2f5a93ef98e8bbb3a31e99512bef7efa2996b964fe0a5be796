{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/helpers/objectSpread","data":{"isAsync":false}},{"name":"../utils/invariant","data":{"isAsync":false}},{"name":"../utils/shallowEqual","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = ScenesReducer;\n\n  var _objectSpread2 = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/helpers/objectSpread\"));\n\n  var _invariant = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"../utils/invariant\"));\n\n  var _shallowEqual = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[3], \"../utils/shallowEqual\"));\n\n  var SCENE_KEY_PREFIX = 'scene_';\n\n  function compareKey(one, two) {\n    var delta = one.length - two.length;\n\n    if (delta > 0) {\n      return 1;\n    }\n\n    if (delta < 0) {\n      return -1;\n    }\n\n    return one > two ? 1 : -1;\n  }\n\n  function compareScenes(one, two) {\n    if (one.index > two.index) {\n      return 1;\n    }\n\n    if (one.index < two.index) {\n      return -1;\n    }\n\n    return compareKey(one.key, two.key);\n  }\n\n  function areScenesShallowEqual(one, two) {\n    return one.key === two.key && one.index === two.index && one.isStale === two.isStale && one.isActive === two.isActive && areRoutesShallowEqual(one.route, two.route);\n  }\n\n  function areRoutesShallowEqual(one, two) {\n    if (!one || !two) {\n      return one === two;\n    }\n\n    if (one.key !== two.key) {\n      return false;\n    }\n\n    return (0, _shallowEqual.default)(one, two);\n  }\n\n  function ScenesReducer(scenes, nextState, prevState) {\n    if (prevState === nextState) {\n      return scenes;\n    }\n\n    var prevScenes = new Map();\n    var freshScenes = new Map();\n    var staleScenes = new Map();\n    scenes.forEach(function (scene) {\n      var key = scene.key;\n\n      if (scene.isStale) {\n        staleScenes.set(key, scene);\n      }\n\n      prevScenes.set(key, scene);\n    });\n    var nextKeys = new Set();\n    nextState.routes.forEach(function (route, index) {\n      var key = SCENE_KEY_PREFIX + route.key;\n      var scene = {\n        index: index,\n        isActive: false,\n        isStale: false,\n        key: key,\n        route: route\n      };\n      (0, _invariant.default)(!nextKeys.has(key), \"navigation.state.routes[\" + index + \"].key \\\"\" + key + \"\\\" conflicts with \" + 'another route!');\n      nextKeys.add(key);\n\n      if (staleScenes.has(key)) {\n        staleScenes.delete(key);\n      }\n\n      freshScenes.set(key, scene);\n    });\n\n    if (prevState) {\n      prevState.routes.forEach(function (route, index) {\n        var key = SCENE_KEY_PREFIX + route.key;\n\n        if (freshScenes.has(key)) {\n          return;\n        }\n\n        staleScenes.set(key, {\n          index: index,\n          isActive: false,\n          isStale: true,\n          key: key,\n          route: route\n        });\n      });\n    }\n\n    var nextScenes = [];\n\n    var mergeScene = function mergeScene(nextScene) {\n      var key = nextScene.key;\n      var prevScene = prevScenes.has(key) ? prevScenes.get(key) : null;\n\n      if (prevScene && areScenesShallowEqual(prevScene, nextScene)) {\n        nextScenes.push(prevScene);\n      } else {\n        nextScenes.push(nextScene);\n      }\n    };\n\n    staleScenes.forEach(mergeScene);\n    freshScenes.forEach(mergeScene);\n    nextScenes.sort(compareScenes);\n    var activeScenesCount = 0;\n    nextScenes.forEach(function (scene, ii) {\n      var isActive = !scene.isStale && scene.index === nextState.index;\n\n      if (isActive !== scene.isActive) {\n        nextScenes[ii] = (0, _objectSpread2.default)({}, scene, {\n          isActive: isActive\n        });\n      }\n\n      if (isActive) {\n        activeScenesCount++;\n      }\n    });\n    (0, _invariant.default)(activeScenesCount === 1, 'there should always be only one scene active, not %s.', activeScenesCount);\n\n    if (nextScenes.length !== scenes.length) {\n      return nextScenes;\n    }\n\n    if (nextScenes.some(function (scene, index) {\n      return !areScenesShallowEqual(scenes[index], scene);\n    })) {\n      return nextScenes;\n    }\n\n    return scenes;\n  }\n});","map":[[11,0,1,0],[13,0,2,0],[15,0,4,0],[15,6,4,6,"SCENE_KEY_PREFIX"],[15,22,4,22],[15,25,4,25],[15,33,4,0],[17,0,9,0],[17,11,9,9,"compareKey"],[17,21,9,0],[17,22,9,20,"one"],[17,25,9,0],[17,27,9,25,"two"],[17,30,9,0],[17,32,9,30],[18,0,10,2],[18,8,10,8,"delta"],[18,13,10,13],[18,16,10,16,"one"],[18,19,10,19],[18,20,10,20,"length"],[18,26,10,16],[18,29,10,29,"two"],[18,32,10,32],[18,33,10,33,"length"],[18,39,10,2],[20,0,11,2],[20,8,11,6,"delta"],[20,13,11,11],[20,16,11,14],[20,17,11,2],[20,19,11,17],[21,0,12,4],[21,13,12,11],[21,14,12,4],[22,0,13,3],[24,0,14,2],[24,8,14,6,"delta"],[24,13,14,11],[24,16,14,14],[24,17,14,2],[24,19,14,17],[25,0,15,4],[25,13,15,11],[25,14,15,12],[25,15,15,4],[26,0,16,3],[28,0,17,2],[28,11,17,9,"one"],[28,14,17,12],[28,17,17,15,"two"],[28,20,17,9],[28,23,17,21],[28,24,17,9],[28,27,17,25],[28,28,17,26],[28,29,17,2],[29,0,18,1],[31,0,23,0],[31,11,23,9,"compareScenes"],[31,24,23,0],[31,25,23,23,"one"],[31,28,23,0],[31,30,23,28,"two"],[31,33,23,0],[31,35,23,33],[32,0,24,2],[32,8,24,6,"one"],[32,11,24,9],[32,12,24,10,"index"],[32,17,24,6],[32,20,24,18,"two"],[32,23,24,21],[32,24,24,22,"index"],[32,29,24,2],[32,31,24,29],[33,0,25,4],[33,13,25,11],[33,14,25,4],[34,0,26,3],[36,0,27,2],[36,8,27,6,"one"],[36,11,27,9],[36,12,27,10,"index"],[36,17,27,6],[36,20,27,18,"two"],[36,23,27,21],[36,24,27,22,"index"],[36,29,27,2],[36,31,27,29],[37,0,28,4],[37,13,28,11],[37,14,28,12],[37,15,28,4],[38,0,29,3],[40,0,31,2],[40,11,31,9,"compareKey"],[40,21,31,19],[40,22,31,20,"one"],[40,25,31,23],[40,26,31,24,"key"],[40,29,31,19],[40,31,31,29,"two"],[40,34,31,32],[40,35,31,33,"key"],[40,38,31,19],[40,39,31,2],[41,0,32,1],[43,0,37,0],[43,11,37,9,"areScenesShallowEqual"],[43,32,37,0],[43,33,37,31,"one"],[43,36,37,0],[43,38,37,36,"two"],[43,41,37,0],[43,43,37,41],[44,0,38,2],[44,11,39,4,"one"],[44,14,39,7],[44,15,39,8,"key"],[44,18,39,4],[44,23,39,16,"two"],[44,26,39,19],[44,27,39,20,"key"],[44,30,39,4],[44,34,40,4,"one"],[44,37,40,7],[44,38,40,8,"index"],[44,43,40,4],[44,48,40,18,"two"],[44,51,40,21],[44,52,40,22,"index"],[44,57,39,4],[44,61,41,4,"one"],[44,64,41,7],[44,65,41,8,"isStale"],[44,72,41,4],[44,77,41,20,"two"],[44,80,41,23],[44,81,41,24,"isStale"],[44,88,39,4],[44,92,42,4,"one"],[44,95,42,7],[44,96,42,8,"isActive"],[44,104,42,4],[44,109,42,21,"two"],[44,112,42,24],[44,113,42,25,"isActive"],[44,121,39,4],[44,125,43,4,"areRoutesShallowEqual"],[44,146,43,25],[44,147,43,26,"one"],[44,150,43,29],[44,151,43,30,"route"],[44,156,43,25],[44,158,43,37,"two"],[44,161,43,40],[44,162,43,41,"route"],[44,167,43,25],[44,168,38,2],[45,0,45,1],[47,0,50,0],[47,11,50,9,"areRoutesShallowEqual"],[47,32,50,0],[47,33,50,31,"one"],[47,36,50,0],[47,38,50,36,"two"],[47,41,50,0],[47,43,50,41],[48,0,51,2],[48,8,51,6],[48,9,51,7,"one"],[48,12,51,6],[48,16,51,14],[48,17,51,15,"two"],[48,20,51,2],[48,22,51,20],[49,0,52,4],[49,13,52,11,"one"],[49,16,52,14],[49,21,52,19,"two"],[49,24,52,4],[50,0,53,3],[52,0,55,2],[52,8,55,6,"one"],[52,11,55,9],[52,12,55,10,"key"],[52,15,55,6],[52,20,55,18,"two"],[52,23,55,21],[52,24,55,22,"key"],[52,27,55,2],[52,29,55,27],[53,0,56,4],[53,13,56,11],[53,18,56,4],[54,0,57,3],[56,0,59,2],[56,11,59,9],[56,38,59,22,"one"],[56,41,59,9],[56,43,59,27,"two"],[56,46,59,9],[56,47,59,2],[57,0,60,1],[59,0,62,15],[59,11,62,24,"ScenesReducer"],[59,24,62,15],[59,25,62,38,"scenes"],[59,31,62,15],[59,33,62,46,"nextState"],[59,42,62,15],[59,44,62,57,"prevState"],[59,53,62,15],[59,55,62,68],[60,0,63,2],[60,8,63,6,"prevState"],[60,17,63,15],[60,22,63,20,"nextState"],[60,31,63,2],[60,33,63,31],[61,0,64,4],[61,13,64,11,"scenes"],[61,19,64,4],[62,0,65,3],[64,0,67,2],[64,8,67,8,"prevScenes"],[64,18,67,18],[64,21,67,21],[64,25,67,25,"Map"],[64,28,67,21],[64,30,67,2],[65,0,68,2],[65,8,68,8,"freshScenes"],[65,19,68,19],[65,22,68,22],[65,26,68,26,"Map"],[65,29,68,22],[65,31,68,2],[66,0,69,2],[66,8,69,8,"staleScenes"],[66,19,69,19],[66,22,69,22],[66,26,69,26,"Map"],[66,29,69,22],[66,31,69,2],[67,0,72,2,"scenes"],[67,4,72,2,"scenes"],[67,10,72,8],[67,11,72,9,"forEach"],[67,18,72,2],[67,19,72,17],[67,29,72,17,"scene"],[67,34,72,22],[67,36,72,26],[68,0,72,26],[68,10,73,12,"key"],[68,13,72,26],[68,16,73,20,"scene"],[68,21,72,26],[68,22,73,12,"key"],[68,25,72,26],[70,0,74,4],[70,10,74,8,"scene"],[70,15,74,13],[70,16,74,14,"isStale"],[70,23,74,4],[70,25,74,23],[71,0,75,6,"staleScenes"],[71,8,75,6,"staleScenes"],[71,19,75,17],[71,20,75,18,"set"],[71,23,75,6],[71,24,75,22,"key"],[71,27,75,6],[71,29,75,27,"scene"],[71,34,75,6],[72,0,76,5],[74,0,77,4,"prevScenes"],[74,6,77,4,"prevScenes"],[74,16,77,14],[74,17,77,15,"set"],[74,20,77,4],[74,21,77,19,"key"],[74,24,77,4],[74,26,77,24,"scene"],[74,31,77,4],[75,0,78,3],[75,5,72,2],[76,0,80,2],[76,8,80,8,"nextKeys"],[76,16,80,16],[76,19,80,19],[76,23,80,23,"Set"],[76,26,80,19],[76,28,80,2],[77,0,81,2,"nextState"],[77,4,81,2,"nextState"],[77,13,81,11],[77,14,81,12,"routes"],[77,20,81,2],[77,21,81,19,"forEach"],[77,28,81,2],[77,29,81,27],[77,39,81,28,"route"],[77,44,81,27],[77,46,81,35,"index"],[77,51,81,27],[77,53,81,45],[78,0,82,4],[78,10,82,10,"key"],[78,13,82,13],[78,16,82,16,"SCENE_KEY_PREFIX"],[78,32,82,32],[78,35,82,35,"route"],[78,40,82,40],[78,41,82,41,"key"],[78,44,82,4],[79,0,83,4],[79,10,83,10,"scene"],[79,15,83,15],[79,18,83,18],[80,0,84,6,"index"],[80,8,84,6,"index"],[80,13,84,11],[80,15,84,6,"index"],[80,20,83,18],[81,0,85,6,"isActive"],[81,8,85,6,"isActive"],[81,16,85,14],[81,18,85,16],[81,23,83,18],[82,0,86,6,"isStale"],[82,8,86,6,"isStale"],[82,15,86,13],[82,17,86,15],[82,22,83,18],[83,0,87,6,"key"],[83,8,87,6,"key"],[83,11,87,9],[83,13,87,6,"key"],[83,16,83,18],[84,0,88,6,"route"],[84,8,88,6,"route"],[84,13,88,11],[84,15,88,6,"route"],[85,0,83,18],[85,7,83,4],[86,0,90,4],[86,30,91,6],[86,31,91,7,"nextKeys"],[86,39,91,15],[86,40,91,16,"has"],[86,43,91,7],[86,44,91,20,"key"],[86,47,91,7],[86,48,90,4],[86,50,92,6],[86,79,92,33,"index"],[86,84,92,6],[86,100,92,48,"key"],[86,103,92,6],[86,129,93,8],[86,145,90,4],[87,0,95,4,"nextKeys"],[87,6,95,4,"nextKeys"],[87,14,95,12],[87,15,95,13,"add"],[87,18,95,4],[87,19,95,17,"key"],[87,22,95,4],[89,0,97,4],[89,10,97,8,"staleScenes"],[89,21,97,19],[89,22,97,20,"has"],[89,25,97,8],[89,26,97,24,"key"],[89,29,97,8],[89,30,97,4],[89,32,97,30],[90,0,100,6,"staleScenes"],[90,8,100,6,"staleScenes"],[90,19,100,17],[90,20,100,18,"delete"],[90,26,100,6],[90,27,100,25,"key"],[90,30,100,6],[91,0,101,5],[93,0,102,4,"freshScenes"],[93,6,102,4,"freshScenes"],[93,17,102,15],[93,18,102,16,"set"],[93,21,102,4],[93,22,102,20,"key"],[93,25,102,4],[93,27,102,25,"scene"],[93,32,102,4],[94,0,103,3],[94,5,81,2],[96,0,105,2],[96,8,105,6,"prevState"],[96,17,105,2],[96,19,105,17],[97,0,107,4,"prevState"],[97,6,107,4,"prevState"],[97,15,107,13],[97,16,107,14,"routes"],[97,22,107,4],[97,23,107,21,"forEach"],[97,30,107,4],[97,31,107,29],[97,41,107,30,"route"],[97,46,107,29],[97,48,107,37,"index"],[97,53,107,29],[97,55,107,47],[98,0,108,6],[98,12,108,12,"key"],[98,15,108,15],[98,18,108,18,"SCENE_KEY_PREFIX"],[98,34,108,34],[98,37,108,37,"route"],[98,42,108,42],[98,43,108,43,"key"],[98,46,108,6],[100,0,109,6],[100,12,109,10,"freshScenes"],[100,23,109,21],[100,24,109,22,"has"],[100,27,109,10],[100,28,109,26,"key"],[100,31,109,10],[100,32,109,6],[100,34,109,32],[101,0,110,8],[102,0,111,7],[104,0,112,6,"staleScenes"],[104,8,112,6,"staleScenes"],[104,19,112,17],[104,20,112,18,"set"],[104,23,112,6],[104,24,112,22,"key"],[104,27,112,6],[104,29,112,27],[105,0,113,8,"index"],[105,10,113,8,"index"],[105,15,113,13],[105,17,113,8,"index"],[105,22,112,27],[106,0,114,8,"isActive"],[106,10,114,8,"isActive"],[106,18,114,16],[106,20,114,18],[106,25,112,27],[107,0,115,8,"isStale"],[107,10,115,8,"isStale"],[107,17,115,15],[107,19,115,17],[107,23,112,27],[108,0,116,8,"key"],[108,10,116,8,"key"],[108,13,116,11],[108,15,116,8,"key"],[108,18,112,27],[109,0,117,8,"route"],[109,10,117,8,"route"],[109,15,117,13],[109,17,117,8,"route"],[110,0,112,27],[110,9,112,6],[111,0,119,5],[111,7,107,4],[112,0,120,3],[114,0,122,2],[114,8,122,8,"nextScenes"],[114,18,122,18],[114,21,122,21],[114,23,122,2],[116,0,124,2],[116,8,124,8,"mergeScene"],[116,18,124,18],[116,21,124,21],[116,30,124,8,"mergeScene"],[116,40,124,21],[116,41,124,21,"nextScene"],[116,50,124,30],[116,52,124,34],[117,0,124,34],[117,10,125,12,"key"],[117,13,124,34],[117,16,125,20,"nextScene"],[117,25,124,34],[117,26,125,12,"key"],[117,29,124,34],[118,0,126,4],[118,10,126,10,"prevScene"],[118,19,126,19],[118,22,126,22,"prevScenes"],[118,32,126,32],[118,33,126,33,"has"],[118,36,126,22],[118,37,126,37,"key"],[118,40,126,22],[118,44,126,44,"prevScenes"],[118,54,126,54],[118,55,126,55,"get"],[118,58,126,44],[118,59,126,59,"key"],[118,62,126,44],[118,63,126,22],[118,66,126,66],[118,70,126,4],[120,0,127,4],[120,10,127,8,"prevScene"],[120,19,127,17],[120,23,127,21,"areScenesShallowEqual"],[120,44,127,42],[120,45,127,43,"prevScene"],[120,54,127,42],[120,56,127,54,"nextScene"],[120,65,127,42],[120,66,127,4],[120,68,127,66],[121,0,130,6,"nextScenes"],[121,8,130,6,"nextScenes"],[121,18,130,16],[121,19,130,17,"push"],[121,23,130,6],[121,24,130,22,"prevScene"],[121,33,130,6],[122,0,131,5],[122,7,127,4],[122,13,131,11],[123,0,132,6,"nextScenes"],[123,8,132,6,"nextScenes"],[123,18,132,16],[123,19,132,17,"push"],[123,23,132,6],[123,24,132,22,"nextScene"],[123,33,132,6],[124,0,133,5],[125,0,134,3],[125,5,124,2],[127,0,136,2,"staleScenes"],[127,4,136,2,"staleScenes"],[127,15,136,13],[127,16,136,14,"forEach"],[127,23,136,2],[127,24,136,22,"mergeScene"],[127,34,136,2],[128,0,137,2,"freshScenes"],[128,4,137,2,"freshScenes"],[128,15,137,13],[128,16,137,14,"forEach"],[128,23,137,2],[128,24,137,22,"mergeScene"],[128,34,137,2],[129,0,139,2,"nextScenes"],[129,4,139,2,"nextScenes"],[129,14,139,12],[129,15,139,13,"sort"],[129,19,139,2],[129,20,139,18,"compareScenes"],[129,33,139,2],[130,0,141,2],[130,8,141,6,"activeScenesCount"],[130,25,141,23],[130,28,141,26],[130,29,141,2],[131,0,142,2,"nextScenes"],[131,4,142,2,"nextScenes"],[131,14,142,12],[131,15,142,13,"forEach"],[131,22,142,2],[131,23,142,21],[131,33,142,22,"scene"],[131,38,142,21],[131,40,142,29,"ii"],[131,42,142,21],[131,44,142,36],[132,0,143,4],[132,10,143,10,"isActive"],[132,18,143,18],[132,21,143,21],[132,22,143,22,"scene"],[132,27,143,27],[132,28,143,28,"isStale"],[132,35,143,21],[132,39,143,39,"scene"],[132,44,143,44],[132,45,143,45,"index"],[132,50,143,39],[132,55,143,55,"nextState"],[132,64,143,64],[132,65,143,65,"index"],[132,70,143,4],[134,0,144,4],[134,10,144,8,"isActive"],[134,18,144,16],[134,23,144,21,"scene"],[134,28,144,26],[134,29,144,27,"isActive"],[134,37,144,4],[134,39,144,37],[135,0,145,6,"nextScenes"],[135,8,145,6,"nextScenes"],[135,18,145,16],[135,19,145,17,"ii"],[135,21,145,16],[135,22,145,6],[135,57,146,11,"scene"],[135,62,145,6],[136,0,147,8,"isActive"],[136,10,147,8,"isActive"],[136,18,147,16],[136,20,147,8,"isActive"],[137,0,145,6],[138,0,149,5],[140,0,150,4],[140,10,150,8,"isActive"],[140,18,150,4],[140,20,150,18],[141,0,151,6,"activeScenesCount"],[141,8,151,6,"activeScenesCount"],[141,25,151,23],[142,0,152,5],[143,0,153,3],[143,5,142,2],[144,0,155,2],[144,28,156,4,"activeScenesCount"],[144,45,156,21],[144,50,156,26],[144,51,155,2],[144,53,157,4],[144,108,155,2],[144,110,158,4,"activeScenesCount"],[144,127,155,2],[146,0,161,2],[146,8,161,6,"nextScenes"],[146,18,161,16],[146,19,161,17,"length"],[146,25,161,6],[146,30,161,28,"scenes"],[146,36,161,34],[146,37,161,35,"length"],[146,43,161,2],[146,45,161,43],[147,0,162,4],[147,13,162,11,"nextScenes"],[147,23,162,4],[148,0,163,3],[150,0,165,2],[150,8,166,4,"nextScenes"],[150,18,166,14],[150,19,166,15,"some"],[150,23,166,4],[150,24,167,6],[150,34,167,7,"scene"],[150,39,167,6],[150,41,167,14,"index"],[150,46,167,6],[151,0,167,6],[151,13,167,24],[151,14,167,25,"areScenesShallowEqual"],[151,35,167,46],[151,36,167,47,"scenes"],[151,42,167,53],[151,43,167,54,"index"],[151,48,167,53],[151,49,167,46],[151,51,167,62,"scene"],[151,56,167,46],[151,57,167,6],[152,0,167,6],[152,5,166,4],[152,6,165,2],[152,8,169,4],[153,0,170,4],[153,13,170,11,"nextScenes"],[153,23,170,4],[154,0,171,3],[156,0,174,2],[156,11,174,9,"scenes"],[156,17,174,2],[157,0,175,1]]},"type":"js/module"}]}